# 策略 3.2 優化動態回測系統 - 完整操作說明

## 📋 目錄

1. 系統概述
2. 基本設定
3. 策略參數詳解
4. 進階風控參數
5. Python 風格優化功能
6. 回測結果解讀
7. 常見問題與建議

---

## 🎯 系統概述

### 特色功能

- **🐍 Python 精華**: 階層決策系統、動態倉位管理、嚴格信號篩選、風險曝險控制
- **⚛️ React 優勢**: 即時參數調整、視覺化分析、多資料源整合、完整追蹤停利
- **✨ 融合創新**: 雙模式切換、智能風控、專業指標算法、最佳化參數

### 核心特點

- **T+1 真實交易邏輯**: T 日收盤後產生信號，T+1 日開盤價執行
- **動態倉位管理**: 根據信心度和風險曝險度自動調整投資比例
- **多層風險控制**: 追蹤停利、ATR 動態停損、持有天數保護

---

## 🔧 基本設定

### 股票設定

| 欄位         | 說明                    | 建議值                  |
| ------------ | ----------------------- | ----------------------- |
| **股票代碼** | 輸入台股代碼（如 2330） | 建議 3-8 支不同產業股票 |
| **新增按鈕** | 將股票加入回測清單      | 避免重複添加            |
| **移除功能** | 點擊股票代碼旁的 × 移除 | 保持清單精簡            |

### 回測期間

| 欄位         | 說明         | 建議值            |
| ------------ | ------------ | ----------------- |
| **開始日期** | 回測起始日期 | 至少 1 年以上數據 |
| **結束日期** | 回測結束日期 | 建議到近期交易日  |

### 資金設定

| 欄位         | 說明                | 建議值              |
| ------------ | ------------------- | ------------------- |
| **初始資金** | 回測起始資金（NT$） | 建議 100 萬以上測試 |

---

## 📊 策略參數詳解

### 基礎技術指標參數

#### RSI 相關參數

| 參數         | 預設值 | 範圍  | 效果說明                   |
| ------------ | ------ | ----- | -------------------------- |
| **RSI 週期** | 14     | 10-21 | 數值越小越敏感，越大越穩定 |
| **RSI 超賣** | 35     | 20-40 | 數值越低進場條件越嚴格     |

**調整建議**:

- **保守型**: RSI 超賣設 30 以下，進場機會少但品質高
- **積極型**: RSI 超賣設 40 以下，進場機會多但勝率可能下降

#### MACD 相關參數

| 參數            | 預設值 | 範圍  | 效果說明                   |
| --------------- | ------ | ----- | -------------------------- |
| **MACD 快線**   | 12     | 8-15  | 快線週期天數，影響信號敏感度   |
| **MACD 慢線**   | 26     | 20-35 | 慢線週期天數，影響信號穩定度   |
| **MACD 信號線** | 9      | 7-12  | 信號線週期，固定建議不調整 |

**MACD 的核心用途**：

1. **趨勢方向確認**：

   - MACD 線 = EMA12 - EMA26
   - MACD > 0：短期趨勢強於中期趨勢（多頭市場）
   - MACD < 0：短期趨勢弱於中期趨勢（空頭市場）

2. **買入信號判斷**：

   - **黃金交叉**：MACD 線上穿信號線 → 買入信號（列為買入訊號的必要條件）
   - **柱狀圖轉正**：MACD 柱狀圖由負轉正 → 動能增強
   - **新黃金交叉**：前期死叉後重新形成黃金交叉 → 最強買入信號

3. **賣出信號判斷**：

   - **死亡交叉**：MACD 線下穿信號線 → 賣出信號
   - **柱狀圖轉負**：MACD 柱狀圖由正轉負 → 動能減弱

4. **信心度加分機制**：
   - **新黃金交叉 + 柱狀圖為正**：+25% 信心度（最高加分）
   - **新黃金交叉**：+20% 信心度
   - **持續黃金交叉且強化**：+15% 信心度
   - **基本黃金交叉**：+10% 信心度(不包含在基本信心度裡)

**參數調整的實際影響**：

| 快線週期 | 敏感度 | 信號頻率 | 適用情況               |
| -------- | ------ | -------- | ---------------------- |
| **8-10** | 很高   | 頻繁     | 短線交易、波動大的股票 |
| **12**   | 高     | 適中     | **標準設定**（預設）   |
| **15**   | 中等   | 較少     | 穩健策略、減少假信號   |

| 慢線週期  | 穩定性 | 信號品質 | 適用情況             |
| --------- | ------ | -------- | -------------------- |
| **20-22** | 低     | 較差     | 短期趨勢跟蹤         |
| **26**    | 高     | 良好     | **標準設定**（預設） |
| **30-35** | 很高   | 優秀     | 長期投資、過濾雜訊   |

**實際交易範例**：

```
某股票 MACD 變化：
Day 1: EMA12=100, EMA26=98 → MACD=+2（多頭）
Day 2: EMA12=102, EMA26=99 → MACD=+3（動能增強）
Day 3: EMA12=101, EMA26=100 → MACD=+1（動能減弱但仍多頭）
Day 4: EMA12=99, EMA26=101 → MACD=-2（轉為空頭）

交易決策：
Day 1-2: 維持持倉或考慮加碼
Day 3: 注意動能減弱，準備出場
Day 4: MACD死亡交叉，執行賣出
```

**與其他指標的配合**：

- **RSI + MACD**：確保在超賣區域且有上升動能
- **成交量 + MACD**：確保有資金推動的真實突破
- **價格動能 + MACD**：雙重確認趨勢轉換

**調整建議**：

- **保守型**：MACD 快線 15、慢線 30，減少假信號
- **積極型**：MACD 快線 10、慢線 22，增加敏感度
- **標準型**：使用預設值 12/26，平衡敏感度與穩定性

#### 進出場控制

| 參數        | 預設值 | 範圍  | 效果說明             |
| ----------- | ------ | ----- | -------------------- |
| **停損(%)** | 6%     | 3-10% | 單筆交易最大虧損限制 |
| **停利(%)** | 12%    | 8-20% | 單筆交易目標獲利     |

### 信心度門檻 ⭐ 重要參數

| 設定範圍      | 類型      | 特色                             | 適用情況           |
| ------------- | --------- | -------------------------------- | ------------------ |
| **0.75-0.85** | 保守型    | 極度嚴格進場，勝率極高但交易稀少 | 資金有限，追求穩定 |
| **0.70-0.75** | 最佳型 ⭐ | Python 優化參數，平衡勝率與頻率  | **推薦設定**       |
| **0.60-0.70** | 積極型    | 適度放寬條件，增加交易機會       | 希望增加交易頻率   |

**實際效果**:

- **信心度 70%**: 每月約 2-4 次交易，勝率 65-75%
- **信心度 80%**: 每月約 1-2 次交易，勝率 75-85%
- **信心度 60%**: 每月約 4-8 次交易，勝率 55-65%

---

## ⚡ 進階風控參數

### ⭐⭐⭐ 高優先級功能

#### 追蹤停利機制

| 參數             | 預設值  | 效果說明                |
| ---------------- | ------- | ----------------------- |
| **啟用追蹤停利** | ✅ 開啟 | 開啟後可保護既有獲利    |
| **追蹤停利(%)**  | 5%      | 從最高點回落 5%時出場   |
| **啟動門檻(%)**  | 3%      | 獲利 3%後才啟動追蹤機制 |

**運作方式**:

1. 股票獲利達 3%後啟動追蹤
2. 持續追蹤股價新高點
3. 從最高點回落 5%時自動出場
4. 可以鎖定部分獲利，避免獲利回吐

**實際例子**:

```
進場價: 100元
股價漲到 103元 → 觸發追蹤停利啟動（獲利3%）
股價漲到 110元 → 追蹤停利價更新為 104.5元（110×0.95）
股價漲到 115元 → 追蹤停利價更新為 109.25元（115×0.95）
股價跌到 109元 → 觸發追蹤停利出場，獲利9%
```

#### 成交量門檻

| 參數           | 預設值 | 效果說明                          |
| -------------- | ------ | --------------------------------- |
| **成交量門檻** | 1.5 倍 | 成交量須為 20 日平均的 1.5 倍以上 |

**效果**:

- **1.0 倍**: 幾乎不過濾，交易頻率高
- **1.5 倍**: 適度過濾，確保有資金關注 ⭐
- **2.0 倍**: 嚴格過濾，只抓放量突破

### ⭐⭐ 中優先級功能

#### ATR 動態停損

| 參數                  | 預設值  | 效果說明                   |
| --------------------- | ------- | -------------------------- |
| **啟用 ATR 動態停損** | ✅ 開啟 | 根據股票波動度動態調整停損 |
| **ATR 週期**          | 14      | 計算 ATR 的天數            |
| **ATR 倍數**          | 2.0     | 停損價 = 進場價 - 2 倍 ATR |

**優點**:

- 高波動股票給予較大停損空間
- 低波動股票設置較緊停損
- 避免被正常波動洗出

#### 最小持有天數保護

| 參數             | 預設值 | 效果說明                        |
| ---------------- | ------ | ------------------------------- |
| **最小持有天數** | 5 天   | 進場後 5 天內不會被技術指標洗出 |

**保護期內規則**:

- ✅ 仍可觸發固定停損（重大虧損保護）
- ✅ 仍可觸發追蹤停利
- ❌ 不會被 RSI 超買、MACD 死叉等技術信號出場

#### 價格動能指標

| 參數                 | 預設值  | 效果說明                 |
| -------------------- | ------- | ------------------------ |
| **啟用價格動能指標** | ✅ 開啟 | 確認股價有上漲動力才進場 |
| **動能週期**         | 5 天    | 計算 5 日價格變化率      |
| **動能門檻**         | 3%      | 5 日漲幅需超過 3%        |

### ⭐ 低優先級功能

#### MA60 季線確認

| 參數                   | 預設值  | 效果說明         |
| ---------------------- | ------- | ---------------- |
| **啟用 MA60 季線確認** | ❌ 關閉 | 額外確認長期趨勢 |

**開啟效果**:

- 只在股價位於季線之上時進場
- 減少逆勢交易，提高勝率
- 但會錯過季線下的反彈機會

---

## 🐍 Python 風格優化功能

### 核心開關

| 功能                | 預設值  | 效果說明                   |
| ------------------- | ------- | -------------------------- |
| **Python 決策邏輯** | ✅ 開啟 | 切換到更嚴格的進場條件     |
| **階層決策系統**    | ✅ 開啟 | 層層篩選，提高信號品質     |
| **動態倉位調整**    | ✅ 開啟 | 根據風險度自動調整投資比例 |

### Python 模式 vs 標準模式對比

| 項目         | 標準模式 | Python 模式            |
| ------------ | -------- | ---------------------- |
| **RSI 門檻** | 較寬鬆   | 更嚴格（需要明確回升） |
| **信號確認** | 基本檢查 | 6 層階層檢查           |
| **倉位管理** | 固定比例 | 動態調整（15%-22.5%）  |
| **風險控制** | 基礎控制 | 總曝險度限制           |
| **交易頻率** | 較高     | 較低但品質更高         |

### 階層決策流程（Python 模式）

```
第1層：數據完整性檢查
第2層：RSI超賣條件（≤35）
第3層：MACD黃金交叉確認
第4層：RSI回升趨勢確認
第5層：成交量放大確認（≥1.5倍）
第6層：K線型態確認（收紅K）
第7層：價格動能確認（>0）
第8層：信心度評分（≥70%）
```

### 動態倉位計算

| 信心度範圍 | 倍數   | 實際倉位 | 說明               |
| ---------- | ------ | -------- | ------------------ |
| **>80%**   | 1.5 倍 | 22.5%    | 高信心度，加大投入 |
| **65-80%** | 1.0 倍 | 15%      | 中等信心，標準投入 |
| **<65%**   | 0.7 倍 | 10.5%    | 低信心度，減少投入 |

### 風險曝險度控制

| 總曝險度   | 倉位調整   | 說明     |
| ---------- | ---------- | -------- |
| **<60%**   | 正常倉位   | 風險可控 |
| **60-75%** | 倉位 ×0.75 | 適度控制 |
| **>75%**   | 倉位 ×0.5  | 嚴格控制 |

---

## 📈 回測結果解讀

### 基本績效指標

| 指標         | 說明                   | 優秀標準       |
| ------------ | ---------------------- | -------------- |
| **最終資金** | 回測結束時的總資產     | >初始資金 ×1.5 |
| **總報酬率** | 整個回測期間的總獲利率 | >50%           |
| **年化報酬** | 換算成年化的報酬率     | >15%           |
| **勝率**     | 獲利交易占總交易的比例 | >60%           |

### 交易統計指標

| 指標             | 說明                 | 理想值      |
| ---------------- | -------------------- | ----------- |
| **總交易次數**   | 完成的買賣循環數量   | 20-50 次/年 |
| **獲利交易**     | 賺錢的交易次數       | -           |
| **虧損交易**     | 賠錢的交易次數       | -           |
| **平均獲利**     | 獲利交易的平均報酬率 | >8%         |
| **平均虧損**     | 虧損交易的平均虧損率 | <-5%        |
| **最大獲利**     | 單筆最大獲利率       | >20%        |
| **最大虧損**     | 單筆最大虧損率       | <-8%        |
| **平均持股天數** | 平均持有股票的天數   | 10-30 天    |

### 獲利因子解讀

| 獲利因子    | 評級   | 說明                 |
| ----------- | ------ | -------------------- |
| **>2.0**    | 優秀   | 策略非常有效         |
| **1.5-2.0** | 良好   | 策略有效，可實際應用 |
| **1.0-1.5** | 及格   | 策略可行，需要優化   |
| **<1.0**    | 需改進 | 策略無效，需重新設計 |

**計算公式**: 獲利因子 = 總獲利金額 ÷ 總虧損金額

### 信心度分布解讀

| 信心度範圍  | 顏色標示 | 建議                   |
| ----------- | -------- | ---------------------- |
| **70%以上** | 🟢 綠色  | 高品質信號，可放心進場 |
| **50-70%**  | 🟡 黃色  | 中等信號，謹慎進場     |
| **50%以下** | 🔴 紅色  | 低品質信號，建議跳過   |

---

## 🔍 策略分析與建議

### 優化方向

#### 勝率不佳時（<60%）

- ✅ 提高信心度門檻至 75%以上
- ✅ 啟用 Python 嚴格模式
- ✅ 增加成交量門檻至 2.0 倍
- ✅ 啟用 MA60 季線確認

#### 交易頻率過低時

- ✅ 降低信心度門檻至 65%
- ✅ 調整 RSI 超賣至 40
- ✅ 降低成交量門檻至 1.2 倍
- ✅ 關閉 Python 嚴格模式

#### 虧損幅度過大時

- ✅ 調緊停損至 4%
- ✅ 啟用 ATR 動態停損
- ✅ 增加最小持有天數至 7 天
- ✅ 調整追蹤停利至 3%

### 不同市場環境建議

#### 牛市環境

```
信心度門檻: 65%（增加機會）
追蹤停利: 啟用（保護獲利）
停利目標: 15%（提高期望）
持有天數: 延長至40天
```

#### 熊市環境

```
信心度門檻: 80%（嚴格篩選）
停損設定: 4%（嚴格控制）
成交量門檻: 2.0倍（確保突破）
MA60確認: 啟用（避免逆勢）
```

#### 震盪市場

```
追蹤停利: 3%啟動，4%出場（快進快出）
停利停損: 8%/-4%（縮小區間）
最小持有: 3天（提高週轉）
```

---

## ❓ 常見問題與解答

### Q1: 為什麼我的交易頻率很低？

**A**: 可能原因：

- 信心度門檻設太高（建議調至 65-70%）
- Python 嚴格模式過於保守（可嘗試關閉）
- 股票選擇太少（建議增加到 8-10 支）
- 回測期間包含熊市（屬正常現象）

### Q2: 為什麼勝率很高但總報酬不佳？

**A**: 可能原因：

- 停利設太低，停損設太寬
- 沒有啟用追蹤停利機制
- 平均獲利小於平均虧損
- 建議調整為停利 12%，停損 6%

### Q3: 系統說沒有資料怎麼辦？

**A**: 解決方法：

- 檢查股票代碼是否正確（如 2330）
- 檢查網路連線狀況
- 嘗試更換回測時間區間
- 系統會自動使用備用資料源

### Q4: 追蹤停利什麼時候會觸發？

**A**: 觸發條件：

- 股票獲利達到啟動門檻（預設 3%）
- 從進場後最高點回落達停利比例（預設 5%）
- 例：100 元進場，漲到 110 元後跌到 104.5 元時觸發

### Q5: Python 模式和標準模式差別？

**A**: 主要差異：

- **Python 模式**: 更嚴格的 6 層篩選，交易少但品質高
- **標準模式**: 較寬鬆條件，交易多但需要更好的風控
- **建議**: 新手使用 Python 模式，有經驗後可切換標準模式

---

## 📚 進階使用技巧

### 參數組合建議

#### 穩健型組合 🛡️

```
信心度門檻: 75%
Python模式: 開啟
追蹤停利: 3%啟動，5%出場
ATR停損: 開啟
成交量門檻: 1.8倍
```

#### 成長型組合 📈

```
信心度門檻: 70%
停利目標: 15%
追蹤停利: 5%啟動，7%出場
價格動能: 開啟
最小持有: 7天
```

#### 積極型組合 🚀

```
信心度門檻: 65%
Python模式: 關閉
成交量門檻: 1.2倍
停利停損: 10%/-5%
持有天數: 不限制
```

### 實戰應用建議

1. **初學者**: 使用預設參數開始，觀察 3 個月
2. **有經驗**: 根據個人風險偏好調整參數
3. **專業用戶**: 可嘗試不同市場環境的參數組合

---

## 🎯 總結

這套回測系統結合了 Python 的嚴謹邏輯和 React 的靈活性，提供了完整的技術分析和風險控制功能。建議用戶：

1. **從預設參數開始**，熟悉系統運作
2. **觀察回測結果**，了解策略特性
3. **漸進式調整**，找到適合的參數組合
4. **定期檢視**，隨市場環境調整策略

記住：**過去績效不代表未來表現**，任何策略都需要持續優化和風險控制。

---

_最後更新：2025 年 8 月_
_版本：策略 3.2 優化版_
